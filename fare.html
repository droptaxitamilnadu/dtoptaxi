<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimated Fare | Droptaxi</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#0D47A1,#1565C0);
  padding:20px;
}

h2{
  text-align:center;
  color:#fff;
  margin-bottom:25px;
  font-weight:900;
}

.container{
  max-width:520px;
  margin:auto;
}

.card{
  background:#fff;
  border-radius:18px;
  padding:18px;
  margin-bottom:22px;
  box-shadow:0 8px 25px rgba(0,0,0,0.15);
}

.car-head{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:10px;
}

.car-head img{
  width:60px;
  height:40px;
  object-fit:cover;
  border-radius:8px;
}

.car-title{
  font-size:18px;
  font-weight:800;
}

.total-box{
  background:linear-gradient(135deg,#ff9800,#ff5722);
  color:#fff;
  padding:16px;
  border-radius:14px;
  text-align:center;
  margin:10px 0;
}

.total-box .amount{
  font-size:26px;
  font-weight:900;
}

.row{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-bottom:6px;
}

.row span{
  font-weight:700;
}

.extra-note{
  font-size:12px;
  background:#fff3e0;
  padding:10px;
  border-radius:10px;
  margin-top:10px;
  line-height:1.6;
}

button{
  width:100%;
  background:#1E4FAF;
  color:#fff;
  padding:13px;
  border:none;
  border-radius:12px;
  font-weight:800;
  margin-top:12px;
}
</style>
</head>
<body>

<h2>Estimated Fare</h2>
<div class="container" id="fareContainer"></div>

<script>

const data = JSON.parse(localStorage.getItem("bookingData"));

const cars = [
  {
    name:"Sedan",
    img:"https://images.unsplash.com/photo-1619767886558-efdc259cde1a",
    one:14, round:13
  },
  {
    name:"Premium Sedan",
    img:"https://images.unsplash.com/photo-1549921296-3a6b1d6f1d6b",
    one:15, round:14
  },
  {
    name:"SUV",
    img:"https://images.unsplash.com/photo-1503376780353-7e6692767b70",
    one:19, round:18
  },
  {
    name:"Innova",
    img:"https://images.unsplash.com/photo-1605559424843-9e4c228bf1c2",
    one:20, round:19
  }
];

let days = 1;

if(data.tripType==="roundtrip"){
  const start = new Date(data.pickupDate);
  const end = new Date(data.returnDate);
  days = Math.floor((end-start)/(1000*60*60*24))+1;
  if(days<1) days=1;
}

const container = document.getElementById("fareContainer");

cars.forEach(car=>{

  let rate = data.tripType==="oneway" ? car.one : car.round;
  let billKM=0;
  let total=0;
  let bata=0;

  if(data.tripType==="oneway"){
      billKM = Math.max(parseFloat(data.km),130);
      bata = 400;
      total = (billKM*rate)+bata;
  }else{
      const actualKM = parseFloat(data.km)*2;
      const minKM = 250*days;
      billKM = Math.max(actualKM,minKM);
      bata = 400*days;
      total = (billKM*rate)+bata;
  }

  const card = document.createElement("div");
  card.className="card";

  card.innerHTML=`
    <div class="car-head">
      <img src="${car.img}" alt="${car.name}">
      <div class="car-title">${car.name}</div>
    </div>

    <div class="total-box">
      <div>TOTAL FARE</div>
      <div class="amount">â‚¹${Math.round(total)}</div>
    </div>

    <div class="row">
      <div>Included Distance</div>
      <span>${billKM.toFixed(0)} KM</span>
    </div>

    <div class="row">
      <div>Rate</div>
      <span>â‚¹${rate}/KM</span>
    </div>

    <div class="row">
      <div>Driver Bata</div>
      <span>â‚¹${bata}</span>
    </div>

    ${data.tripType==="roundtrip"?
      `<div class="row">
        <div>Total Days</div>
        <span>${days}</span>
      </div>`:""}

    <div class="extra-note">
      â€¢ Toll Charges Extra<br>
      â€¢ Parking Charges Extra<br>
      â€¢ State Permit Charges Extra<br>
      â€¢ Pet Travel Charges Extra<br>
      â€¢ Carrier Charges Extra<br>
      â€¢ Hills Station Charges Extra
    </div>

    <button onclick="confirmBooking('${car.name}',${Math.round(total)},${billKM},${rate},${bata})">
      Confirm Booking
    </button>
  `;

  container.appendChild(card);

});


function confirmBooking(car,total,km,rate,bata){

  const bookingID="BT"+Math.floor(Math.random()*999999);

  const message =
`ğŸ“ Contact: ${data.contact}
ğŸ“ Pickup: ${data.pickup}
ğŸ Drop: ${data.drop}
ğŸ§­ Trip: ${data.tripType==="oneway"?"One Way":"Round Trip"}
ğŸ†” Booking ID: ${bookingID}

ğŸš— Car: ${car}
ğŸ’° Total Fare: â‚¹${total}
â¬†ï¸ Upto Km : ${km.toFixed(0)} km
ğŸ“ Per Km: â‚¹${rate}
ğŸ§‘â€âœˆï¸ Driver Bata: â‚¹${bata}
ğŸ›£ Toll / Parking / Permit: Extra
ğŸ¾ Pet Charges: Extra
ğŸ’ Carrier Charges: Extra
â›° Hills Charges: Extra

ğŸ—º Pickup Map:
https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(data.pickup)}
`;

  fetch(`https://api.telegram.org/botYOUR_TOKEN/sendMessage?chat_id=-1003801956191&text=${encodeURIComponent(message)}`);

  localStorage.setItem("finalBooking",JSON.stringify({
    bookingID,car,total,km,rate,bata,days,...data
  }));

  window.location="confirm.html";
}

</script>

</body>
</html>