<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimated Fare - Droptaxi</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:#f2f4f7;
  padding:15px;
}

h2{
  text-align:center;
  color:#1E4FAF;
  margin-bottom:20px;
}

.card{
  background:#fff;
  border-radius:16px;
  padding:18px;
  margin-bottom:18px;
  box-shadow:0 5px 20px rgba(0,0,0,0.08);
}

.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.title{
  font-size:18px;
  font-weight:700;
}

.price{
  font-size:20px;
  font-weight:800;
  color:#000;
}

.sub{
  font-size:13px;
  color:#1E4FAF;
  margin:5px 0 10px;
}

.info{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  margin-bottom:10px;
}

.breakup{
  display:none;
  font-size:13px;
  background:#f9f9f9;
  padding:10px;
  border-radius:10px;
  margin-top:10px;
}

.btn{
  margin-top:12px;
  background:#FF6F00;
  color:#fff;
  border:none;
  padding:12px;
  width:100%;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>
<body>

<h2>Estimated Fare</h2>

<div id="fareContainer"></div>

<script>

// =====================
// GET BOOKING DATA
// =====================
const booking = JSON.parse(localStorage.getItem("bookingData"));

if(!booking){
  document.body.innerHTML = "<h2>No booking data found.</h2>";
}

// =====================
// TARIFF CONFIG
// =====================
const cars = [
  {name:"Sedan", rateOne:14, rateRound:13},
  {name:"Premium Sedan", rateOne:15, rateRound:14},
  {name:"SUV", rateOne:19, rateRound:18},
  {name:"Innova", rateOne:20, rateRound:19}
];

// =====================
// DAYS CALCULATION
// =====================
let days = 1;

if(booking.tripType === "round" && booking.returnDate){
  const d1 = new Date(booking.pickupDate);
  const d2 = new Date(booking.returnDate);
  const diff = Math.ceil((d2 - d1)/(1000*60*60*24)) + 1;
  days = diff > 0 ? diff : 1;
}

// =====================
// FAKE KM (Until API integrated)
// Replace with Google Distance API
// =====================
let baseKm = 180; // temporary
let totalKm = booking.tripType === "round"
  ? Math.max(250 * days, baseKm * 2)
  : Math.max(130, baseKm);

// =====================
// RENDER CAR CARDS
// =====================
const container = document.getElementById("fareContainer");

cars.forEach((car,i)=>{

  let rate = booking.tripType === "round"
    ? car.rateRound
    : car.rateOne;

  let fare = totalKm * rate;

  let bata = booking.tripType === "round"
    ? 400 * days
    : 400;

  let total = fare + bata;

  container.innerHTML += `
    <div class="card">
      <div class="top">
        <div class="title">${car.name}</div>
        <div class="price">â‚¹${total.toLocaleString()}</div>
      </div>

      <div class="sub">${booking.tripType === "round" ? "Round Trip" : "One Way"} | AC</div>

      <div class="info">
        <div>${totalKm} KM</div>
        <div>${days} Day(s)</div>
        <div>â‚¹${rate}/KM</div>
      </div>

      <div onclick="toggleBreakup(${i})" style="color:#1E4FAF;font-weight:600;cursor:pointer;">
        Fare breakup
      </div>

      <div id="breakup${i}" class="breakup">
        Distance Fare: â‚¹${fare.toLocaleString()} <br>
        Driver Bata: â‚¹${bata.toLocaleString()} <br>
        <strong>Total: â‚¹${total.toLocaleString()}</strong>
      </div>

      <button class="btn" onclick="confirmBooking('${car.name}','â‚¹${total}')">
        Confirm Booking
      </button>
    </div>
  `;
});

// =====================
// BREAKUP TOGGLE
// =====================
function toggleBreakup(id){
  const el = document.getElementById("breakup"+id);
  el.style.display = el.style.display === "block" ? "none" : "block";
}

// =====================
// CONFIRM BOOKING
// =====================
function confirmBooking(car,price){

  const bookingId = "DT" + Date.now();

  fetch("https://api.telegram.org/bot8506524258:AAFkQJFjQUbgSFhMc5pWfhVaDvnFdvtst1I/sendMessage",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      chat_id:"-1003801956191",
      text:
`ðŸš– DROPTAXI BOOKING CONFIRMED

Booking ID: ${bookingId}
Car: ${car}
Fare: ${price}

From: ${booking.pickup}
To: ${booking.drop}
Date: ${booking.pickupDate}
Time: ${booking.pickupTime}
Trip: ${booking.tripType.toUpperCase()}`
    })
  });

  alert("Booking Confirmed! ID: " + bookingId);
}

</script>

</body>
</html>